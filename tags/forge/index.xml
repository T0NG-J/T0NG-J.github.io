<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Forge on TongJ-Writeups</title>
    <link>https://t0ng-j.github.io/tags/forge/</link>
    <description>Recent content in Forge on TongJ-Writeups</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 16 Feb 2022 19:51:35 +0700</lastBuildDate><atom:link href="https://t0ng-j.github.io/tags/forge/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>HTB - Forge</title>
      <link>https://t0ng-j.github.io/posts/htb-forge/</link>
      <pubDate>Wed, 16 Feb 2022 19:51:35 +0700</pubDate>
      
      <guid>https://t0ng-j.github.io/posts/htb-forge/</guid>
      <description>HTB - Forge Linux - Medium IP = 10.10.11.111
Enumeration Same as always I run nmap first.
Nmap: nmap -sSVC -p- -v -T4 -oA nmap/forge forge.htb
   PORT SERVICE &amp;amp; VERSION     21/tcp ftp   22/tcp OpenSSH 8.2p1 Ubuntu 4ubuntu0.3   80/tcp Apache httpd 2.4.41     ftp is interesting but I need to find the credentials first.
 Gobuster (dir): gobuster dir -u http://forge.</description>
      <content>&lt;h1 id=&#34;htb---forge&#34;&gt;HTB - Forge&lt;/h1&gt;
&lt;h2 id=&#34;linux---medium&#34;&gt;Linux - Medium&lt;/h2&gt;
&lt;p&gt;IP = 10.10.11.111&lt;/p&gt;
&lt;h2 id=&#34;enumeration&#34;&gt;Enumeration&lt;/h2&gt;
&lt;p&gt;Same as always I run &lt;code&gt;nmap&lt;/code&gt; first.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nmap:&lt;/strong&gt; &lt;code&gt;nmap -sSVC -p- -v -T4 -oA nmap/forge forge.htb&lt;/code&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;PORT&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;SERVICE &amp;amp; VERSION&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;21/tcp&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ftp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;22/tcp&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;OpenSSH 8.2p1 Ubuntu 4ubuntu0.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;80/tcp&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Apache httpd 2.4.41&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154244127-d7c029ff-86e2-41d3-9b27-da507c18ca0c.png&#34; alt=&#34;nmap&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;ftp&lt;/code&gt; is interesting but I need to find the credentials first.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Gobuster (dir):&lt;/strong&gt; &lt;code&gt;gobuster dir -u http://forge.htb/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -z -o gobuster/forge-dir&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154246653-d17e6ca4-a2d1-4d87-b943-d2df42204163.png&#34; alt=&#34;gobuster_dir&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There&amp;rsquo;s the upload route.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Gobuster (vhost):&lt;/strong&gt; &lt;code&gt;gobuster vhost -u http://forge.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -z -o subdomain/sub.txt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154246976-ea9e2c3a-3a58-4b6f-9dcd-386ac8208c03.png&#34; alt=&#34;gobuster_vhost&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Found &lt;code&gt;admin.forge.htb&lt;/code&gt; subdomain but can&amp;rsquo;t directly access it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154247049-9362cf47-1ad8-4a44-bdd7-5d6ec498b9ef.png&#34; alt=&#34;web1&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Look like this web have SSRF vulnerability, So I try to inject with 127.0.0.1, localhost or admin.forge.htb but it&amp;rsquo;s all getting filtered.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154247634-086c0d01-ae5c-464d-8f17-9e34f564caa9.png&#34; alt=&#34;found_vul&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I bypass the filter with Uppercase character and It just works.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://c.tenor.com/rkI1a8s2Z6QAAAAC/todd-howard-it-just-works.gif&#34; alt=&#34;meme&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154248479-23093ee3-b85d-47c9-8826-101c4d37869a.png&#34; alt=&#34;admin&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Now I got the &lt;code&gt;admin.forge.htb&lt;/code&gt; page and It has another interesting route.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;user:heightofsecurity123!&lt;/code&gt;
&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154248708-a05f643b-b70f-4b04-917e-8cbe650dc9a1.png&#34; alt=&#34;announcement&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The announcements page give the information of &lt;code&gt;ftp&lt;/code&gt; credential and how to upload the file with &lt;code&gt;ftp&lt;/code&gt; through URL, So I can construct the payload to retrieve some essential file like &lt;code&gt;.ssh/id_rsa&lt;/code&gt; the ssh private key.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154250396-95085771-4594-45e2-b38d-114e0e28c8fa.png&#34; alt=&#34;try_ssh&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I try &lt;code&gt;ssh&lt;/code&gt; with the &lt;code&gt;ftp&lt;/code&gt; credential but It not work and It only uses the &lt;strong&gt;Private key&lt;/strong&gt; for authentication.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;exploitation&#34;&gt;Exploitation&lt;/h2&gt;
&lt;p&gt;With the information on the announcements page, I can retrieve the file with the parameter &lt;code&gt;u&lt;/code&gt;
The payload will be:
&lt;code&gt;http://admin.Forge.htb/upload?u=ftp://user:heightofsecurity123!@Forge.htb/.ssh/id_rsa&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now I can login with &lt;code&gt;user&lt;/code&gt;and got the user part as well.
&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154251209-796b7d61-34e1-4ae6-955e-80f929bce2b4.png&#34; alt=&#34;user&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;privilege-escalation&#34;&gt;Privilege Escalation&lt;/h2&gt;
&lt;p&gt;1st things TODO after got user try &lt;code&gt;sudo -l&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154251225-1c16f6db-0a8e-478e-94a9-d4d6fab246ff.png&#34; alt=&#34;sudo -l&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The &lt;code&gt;remote-manage.py&lt;/code&gt; file can lead to the root part.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154254262-f7ba2e73-5ab8-43a9-998a-c8af6eaa9a46.png&#34; alt=&#34;remote-manage.py&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154251961-91dce625-5240-405b-8e62-ceb526f832ed.png&#34; alt=&#34;remote-manage.py2&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;After reading the source code of &lt;code&gt;remote-manage.py&lt;/code&gt; look like It&amp;rsquo;ll create a socket server waiting for connection on a random port.
And It checking the secret password that obvious is in the program.
The actually interesting part is &lt;code&gt;pdb&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://c.tenor.com/zHOmFEhWax8AAAAC/sarcasm-obviously.gif&#34; alt=&#34;meme2&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pdb&lt;/code&gt; is The module pdb defines an interactive source code debugger for Python programs
Then I just run the &lt;code&gt;remote-manage.py&lt;/code&gt; with &lt;code&gt;sudo&lt;/code&gt; permission and use &lt;code&gt;nc&lt;/code&gt; to connect back to the socket server.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154255310-08961d9e-6aae-49ea-8883-99d00875d08b.png&#34; alt=&#34;error&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;And then I&amp;rsquo;m trying to cause an error to trigger the &lt;code&gt;pdb&lt;/code&gt; with string input.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://user-images.githubusercontent.com/58801547/154255456-0e23e183-e08a-44f8-a987-868b9575d203.png&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The exception handler triggers the pdb and then just import os module and boom! got the root shell.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This machine should be easy in my opinion lul.&lt;/p&gt;
&lt;h2 id=&#34;ref&#34;&gt;Ref:&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.python.org/3/library/pdb.html&#34;&gt;https://docs.python.org/3/library/pdb.html&lt;/a&gt;&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
